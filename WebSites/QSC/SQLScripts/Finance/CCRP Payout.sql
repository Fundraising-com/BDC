--Need to run this each Payout
--Campaigns that are run by a CCRP FM, but whose account is not set to belong to CCRP
--Need to look at newest campaign in case a QSP FM took it back over
select distinct acc.Id AccountID--, acc.Name, fm.Firstname + ' ' + fm.Lastname FM, camp.ID CampaignID, camp.StartDate, camp.EndDate--, camp.*, cNew.*
from QSPCanadaCommon..CAccount acc
join QSPCanadaCommon..Campaign camp on camp.BillToAccountID = acc.Id

LEFT JOIN	(QSPCanadaCommon..CampaignCommissionSplit ccs
JOIN		QSPCanadaCommon..FieldManager fmSplit
				ON	fmSplit.FMID = ccs.FMID)

				ON	ccs.CampaignID = camp.ID
JOIN QSPCanadaCommon..FieldManager FM on fm.FMID = ISNULL(fmSplit.FMID, camp.FMID)

left join qspcanadacommon..Campaign cNew on cNew.BillToAccountID = camp.BillToAccountID and cNew.StartDate > camp.StartDate
where fm.FMID in (1546, 1547, 1549, 1548, 1550, 1551)
and acc.ParentID not in (33873, 33874)
and acc.CAccountCodeGroup not in ('Comm')
and isnull(cNew.FMID,0) in (0, 1546, 1547, 1548, 1549, 1550, 1551)
and camp.StartDate between '2017-01-01' and '2017-06-30'
order by  acc.ID

--Account marked as CCRP
select acc.Id AccountID, acc.Name, *
from QSPCanadaCommon..CAccount acc
where acc.ParentID = 33873
order by acc.ID

--Accounts marked as Eean's
select acc.Id AccountID, acc.Name 
from QSPCanadaCommon..CAccount acc
where acc.ParentID = 33874
order by acc.ID

select acc.Id AccountID, acc.Name, *
from QSPCanadaCommon..CAccount acc
left join QSPCanadaCommon..Campaign camp on camp.BillToAccountID = acc.Id
where acc.ParentID = 33873
order by acc.ID

select acc.Id AccountID, acc.Name, *
from QSPCanadaCommon..CAccount acc
left join QSPCanadaCommon..Campaign camp on camp.BillToAccountID = acc.Id
where camp.FMID in (1546, 1547, 1548, 1549, 1550, 1551)
order by acc.ID

--Account marked as CCRP but run by a non-CCRP Rep, and was not an original CCRP Account. Need to unmark these from belonging to CCRP.
select acc.Id AccountID, acc.Name, fm.firstname + ' ' + fm.lastname FM, camp.ID CampaignID, camp.StartDate CampaignStartDate, camp.EndDate CampaignEndDate, camp.Estimatedgross EstimatedGrossSalesOfRegularCampaign, camp.NumberOfStaff
from QSPCanadaCommon..CAccount acc
join QSPCanadaCommon..Campaign camp on camp.BillToAccountID = acc.Id
join QSPCanadaCommon..fieldmanager fm on fm.fmid = camp.fmid
where acc.ParentID in (33873, 33874)
and camp.fmid not in (1546, 1547, 1548, 1549, 1550, 1551)
and camp.startdate between '2017-01-01' and '2017-12-31'
and camp.status = 37002
and exists
		(select 1 
		from	qspcanadaordermanagement..batch b
		join	qspcanadafinance..invoice i on i.order_id = b.orderid
		where	b.campaignid = camp.id
		and		i.invoice_date between '2017-01-01' and '2017-12-31')
and acc.Id NOT IN (
144	,
149	,
151	,
156	,
159	,
174	,
176	,
177	,
193	,
194	,
200	,
202	,
204	,
219	,
225	,
232	,
275	,
276	,
277	,
279	,
286	,
293	,
295	,
310	,
316	,
324	,
337	,
348	,
353	,
355	,
359	,
389	,
399	,
404	,
431	,
432	,
437	,
446	,
447	,
452	,
454	,
456	,
475	,
486	,
489	,
505	,
520	,
540	,
543	,
547	,
557	,
561	,
570	,
577	,
580	,
582	,
585	,
587	,
589	,
592	,
596	,
605	,
612	,
629	,
631	,
638	,
641	,
655	,
656	,
657	,
658	,
661	,
670	,
673	,
680	,
682	,
690	,
703	,
704	,
723	,
735	,
736	,
738	,
741	,
748	,
753	,
757	,
760	,
761	,
763	,
775	,
781	,
783	,
784	,
793	,
795	,
802	,
816	,
817	,
819	,
828	,
829	,
831	,
832	,
834	,
838	,
841	,
847	,
848	,
857	,
858	,
874	,
875	,
878	,
879	,
891	,
896	,
898	,
903	,
905	,
933	,
973	,
995	,
996	,
1006	,
1009	,
1018	,
1022	,
1031	,
1037	,
1038	,
1039	,
1076	,
1081	,
1084	,
1096	,
1098	,
1099	,
1106	,
1110	,
1133	,
1139	,
1142	,
1145	,
1146	,
1196	,
1302	,
1348	,
1401	,
1406	,
1420	,
1437	,
1466	,
1471	,
1478	,
1481	,
1491	,
1494	,
1499	,
1500	,
1505	,
1526	,
1527	,
1529	,
1536	,
1542	,
1545	,
1551	,
1559	,
1560	,
1569	,
1586	,
1590	,
1593	,
1599	,
1612	,
1613	,
1616	,
1650	,
1653	,
1661	,
1663	,
1665	,
1668	,
1669	,
1670	,
1681	,
1682	,
1687	,
1688	,
1699	,
1701	,
1702	,
1710	,
1713	,
1717	,
1751	,
1761	,
1763	,
1771	,
1772	,
1807	,
1812	,
1815	,
1818	,
1823	,
1827	,
1837	,
1859	,
1866	,
1922	,
1949	,
1968	,
2014	,
2040	,
2051	,
2078	,
2104	,
2114	,
2129	,
2154	,
2174	,
2184	,
2195	,
2212	,
2214	,
2226	,
2230	,
2232	,
2233	,
2236	,
2237	,
2239	,
2240	,
2242	,
2247	,
2248	,
2250	,
2253	,
2257	,
2262	,
2263	,
2265	,
2268	,
2278	,
2283	,
2285	,
2299	,
2304	,
2309	,
2314	,
2317	,
2328	,
2333	,
2344	,
2355	,
2364	,
2368	,
2378	,
2384	,
2748	,
2837	,
3091	,
3102	,
3154	,
3167	,
3221	,
3224	,
3227	,
3229	,
3234	,
3296	,
3297	,
3311	,
3315	,
3337	,
3340	,
3349	,
3367	,
3369	,
3372	,
3381	,
3383	,
3397	,
3421	,
3425	,
3428	,
3431	,
3440	,
3451	,
3456	,
3463	,
3468	,
3498	,
3500	,
3534	,
3537	,
3546	,
3548	,
3564	,
3569	,
3580	,
3590	,
3599	,
3642	,
3643	,
3647	,
3659	,
3667	,
3670	,
3680	,
3686	,
3692	,
3720	,
3740	,
3760	,
3762	,
3772	,
3774	,
3902	,
3905	,
3947	,
3971	,
3985	,
4135	,
4142	,
4210	,
4211	,
4227	,
4413	,
4446	,
4491	,
4498	,
4504	,
4508	,
4539	,
4570	,
4598	,
4635	,
4651	,
4654	,
4656	,
4669	,
4679	,
4684	,
4686	,
4691	,
4692	,
4695	,
4712	,
4719	,
4724	,
4727	,
4729	,
4732	,
4736	,
4742	,
4746	,
4772	,
4787	,
4809	,
4834	,
4878	,
4914	,
4953	,
5169	,
5747	,
5795	,
5796	,
5873	,
5884	,
5886	,
6027	,
6034	,
6046	,
6052	,
6060	,
6069	,
6080	,
6087	,
6107	,
6108	,
6132	,
6137	,
6145	,
6150	,
6172	,
6183	,
6224	,
6231	,
6289	,
6317	,
6378	,
6379	,
6388	,
6393	,
6400	,
6401	,
6449	,
6731	,
6866	,
6905	,
6990	,
7086	,
7179	,
7209	,
7271	,
7379	,
7395	,
7462	,
7463	,
7479	,
7483	,
7484	,
7485	,
7486	,
7488	,
7489	,
7650	,
7663	,
7664	,
7671	,
7680	,
7682	,
7686	,
7688	,
7697	,
7698	,
7700	,
7705	,
7747	,
7751	,
7757	,
7797	,
7799	,
7803	,
7813	,
7871	,
7924	,
7925	,
7933	,
7941	,
7942	,
7947	,
7952	,
8003	,
8015	,
8025	,
8042	,
8048	,
8055	,
8058	,
8059	,
8061	,
8062	,
8066	,
8069	,
8072	,
8077	,
8079	,
8084	,
8085	,
8086	,
8088	,
8089	,
8090	,
8091	,
8092	,
8094	,
8095	,
8096	,
8114	,
8120	,
8124	,
8127	,
8130	,
8140	,
8146	,
8147	,
8148	,
8154	,
8157	,
8158	,
8159	,
8160	,
8164	,
8168	,
8169	,
8174	,
8177	,
8178	,
8181	,
8185	,
8189	,
8191	,
8192	,
8194	,
8195	,
8202	,
8204	,
8206	,
8207	,
8209	,
8210	,
8212	,
8216	,
8219	,
8220	,
8225	,
8230	,
8231	,
8241	,
8244	,
8245	,
8248	,
8251	,
8260	,
8269	,
8273	,
8287	,
8294	,
8307	,
8328	,
8366	,
8434	,
8450	,
8490	,
8521	,
8550	,
8568	,
8576	,
8612	,
8662	,
8786	,
8812	,
8824	,
8827	,
8840	,
8853	,
8951	,
8960	,
8961	,
8987	,
8998	,
9031	,
9071	,
9182	,
9284	,
9304	,
9762	,
9808	,
9833	,
9852	,
9892	,
9901	,
9902	,
9904	,
9929	,
9932	,
9933	,
9935	,
9951	,
10167	,
10173	,
10178	,
10181	,
10192	,
10193	,
10197	,
10221	,
10223	,
10225	,
10232	,
10237	,
10246	,
10269	,
10293	,
10296	,
10335	,
10339	,
10346	,
10357	,
10364	,
10369	,
10371	,
10446	,
10467	,
10509	,
10517	,
10519	,
10520	,
10537	,
10538	,
10552	,
10557	,
10583	,
10595	,
10600	,
10607	,
10617	,
10626	,
10639	,
10655	,
10665	,
10712	,
10724	,
10760	,
10793	,
10798	,
10834	,
10840	,
10963	,
10983	,
10990	,
11047	,
11098	,
11682	,
11806	,
13143	,
14765	,
14766	,
14773	,
15375	,
15378	,
15393	,
15416	,
15423	,
15441	,
15474	,
15475	,
15484	,
15487	,
15490	,
15497	,
15529	,
15563	,
15591	,
15592	,
15595	,
15602	,
15605	,
15635	,
15638	,
15643	,
15644	,
15650	,
15677	,
15679	,
15684	,
15685	,
15691	,
15692	,
15693	,
15770	,
15773	,
15779	,
15782	,
15783	,
15792	,
15795	,
15798	,
15803	,
15806	,
15820	,
15828	,
15834	,
15848	,
15853	,
15856	,
15859	,
15864	,
15873	,
15874	,
15880	,
15881	,
15908	,
15913	,
15920	,
15927	,
15928	,
15940	,
15941	,
15953	,
15955	,
15958	,
15961	,
15969	,
15995	,
15996	,
16000	,
16003	,
16007	,
16008	,
16011	,
16013	,
16021	,
16022	,
16023	,
16028	,
16051	,
16057	,
16059	,
16065	,
16070	,
16073	,
16074	,
16075	,
16085	,
16089	,
16100	,
16121	,
16128	,
16132	,
16134	,
16140	,
16144	,
16154	,
16157	,
16160	,
16165	,
16168	,
16171	,
16174	,
16176	,
16185	,
16202	,
16206	,
16219	,
16227	,
16271	,
16274	,
16492	,
16509	,
16516	,
16533	,
16535	,
16538	,
16539	,
16561	,
16610	,
16639	,
16657	,
16671	,
16680	,
16681	,
16707	,
16749	,
16784	,
16792	,
16821	,
16994	,
16995	,
17072	,
17090	,
17154	,
17233	,
17276	,
17378	,
17413	,
17584	,
17643	,
18047	,
18048	,
18202	,
18433	,
18454	,
18482	,
18568	,
18601	,
18644	,
18649	,
18666	,
18706	,
30148	,
30235	,
30335	,
30359	,
30503	,
30571	,
31502	,
31839	,
31857	,
31898	,
31899	,
31918	,
31964	,
32074	,
32095	,
32096	,
32104	,
32109	,
32213	,
32303	,
32406	,
32466	,
32510	,
32878	,
32892	,
32932	,
32933	,
32957	,
32958	,
32959	,
33041	,
33097	,
33171	,
33172	,
33177	,
33660	,
33851	,
33877	,
33878	,
33880	,
33882	,
33885	,
33889	,
33890	,
33891	,
33894	,
33896	,
33897	,
33898	,
33900	,
33901	,
33903	,
33904	,
33905	,
33906	,
33908	,
33909	,
33912	,
33913	,
33915	,
33916	,
33917	,
33919	,
33920	,
33923	,
33924	,
33925	,
33928	,
33929	,
33931	,
33933	,
33934	,
33935	,
33936	,
33938	,
33939	,
33944	,
33946	,
33949	,
33954	,
33955	,
33956	,
33959	,
33960	,
33963	,
33966	,
33967	,
33971	,
33972	,
33973	,
33977	,
33979	,
33981	,
33982	,
33984	,
33987	,
33988	,
33994	,
33995	,
33999	,
34003	,
34004	,
34005	,
34009	,
34012	,
34013	,
34051	,
34053	,
34062	,
34066	,
34069	,
34072	,
34095	,
34096	,
34098	,
34099	,
34101	,
34102	,
34103	,
34105	,
34111	,
34112	,
34127)
order by acc.ID

----Fixup each Payout
begin tran
update QSPCanadaCommon..CAccount
set ParentID = 33873
where ID in (
1677,
1698,
7401,
8155,
34372,
34932,
34933,
34946,
34963,
34964,
34965,
34978,
34997,
35000,
35004,
35015)
--commit tran

begin tran
update QSPCanadaCommon..CAccount
set ParentID = ID
where ID in (
2052,
2064,
2092,
2190,
2291,
2291,
2302,
2322,
2341,
3230,
3304,
3858,
3953,
15579,
15579,
15645,
15947,
15947,
15991,
16150,
16536,
17083,
18053,
18120,
30536,
34050,
34144)

--commit tran

----One-time Update

--Eean
select 'Eean' AccountType, acc.*
into #CCRP
from QSPCanadaCommon..CAccount acc
where acc.ID IN (
144,
149,
151,
156,
159,
174,
176,
177,
193,
194,
200,
202,
204,
219,
225,
232,
275,
276,
277,
279,
286,
295,
310,
316,
324,
337,
348,
353,
355,
389,
399,
404,
431,
432,
437,
446,
447,
452,
454,
456,
475,
505,
520,
540,
543,
547,
557,
561,
577,
582,
585,
629,
641,
741,
748,
1196,
1302,
1348,
1401,
1406,
1420,
1437,
1478,
1807,
1812,
1815,
1818,
1922,
3337,
3340,
3349,
5747,
16176,
16792,
17276,
17378,
17413,
30359,
34103)

UNION ALL

--Everyone else
select 'EveryoneElse' AccountType, acc.*
from QSPCanadaCommon..CAccount acc
where acc.ID IN (
293,
359,
486,
489,
580,
587,
589,
592,
596,
605,
612,
631,
638,
655,
656,
657,
658,
661,
670,
673,
680,
682,
690,
723,
735,
736,
738,
753,
757,
760,
761,
763,
775,
781,
783,
784,
793,
795,
802,
816,
817,
819,
828,
829,
831,
832,
834,
838,
841,
848,
857,
858,
874,
875,
878,
891,
896,
903,
905,
933,
973,
995,
996,
1006,
1009,
1018,
1022,
1031,
1037,
1038,
1039,
1076,
1081,
1084,
1096,
1098,
1099,
1106,
1110,
1133,
1139,
1142,
1145,
1146,
1466,
1471,
1481,
1491,
1499,
1505,
1526,
1527,
1529,
1542,
1545,
1551,
1559,
1560,
1569,
1586,
1590,
1593,
1599,
1612,
1613,
1616,
1650,
1653,
1661,
1663,
1665,
1668,
1669,
1670,
1681,
1682,
1687,
1688,
1699,
1701,
1710,
1713,
1717,
1751,
1761,
1763,
1771,
1772,
1823,
1827,
1837,
1859,
1866,
1949,
2014,
2051,
2078,
2104,
2114,
2129,
2154,
2174,
2184,
2195,
2212,
2214,
2226,
2230,
2232,
2233,
2236,
2237,
2239,
2240,
2242,
2247,
2248,
2250,
2253,
2257,
2262,
2263,
2268,
2278,
2285,
2299,
2304,
2309,
2314,
2317,
2328,
2333,
2344,
2355,
2364,
2368,
2378,
2384,
2748,
2837,
3091,
3102,
3221,
3224,
3227,
3229,
3234,
3296,
3297,
3311,
3315,
3367,
3369,
3372,
3381,
3383,
3397,
3421,
3425,
3428,
3431,
3440,
3451,
3456,
3463,
3463,
3468,
3498,
3500,
3534,
3537,
3546,
3548,
3564,
3569,
3580,
3590,
3599,
3642,
3643,
3647,
3659,
3667,
3670,
3680,
3686,
3692,
3720,
3740,
3760,
3762,
3772,
3774,
3971,
3985,
4135,
4142,
4210,
4211,
4227,
4413,
4446,
4498,
4504,
4508,
4539,
4570,
4598,
4635,
4651,
4654,
4656,
4669,
4679,
4684,
4686,
4691,
4692,
4695,
4712,
4719,
4724,
4727,
4729,
4732,
4736,
4742,
4746,
4772,
4787,
4809,
4834,
4878,
4914,
4953,
5169,
5873,
5886,
6027,
6034,
6046,
6060,
6069,
6080,
6107,
6108,
6132,
6137,
6145,
6150,
6172,
6183,
6231,
6378,
6379,
6388,
6393,
6400,
6401,
6449,
6731,
6866,
6905,
6990,
7086,
7179,
7209,
7271,
7379,
7395,
7462,
7463,
7479,
7483,
7484,
7485,
7486,
7488,
7489,
7650,
7663,
7664,
7671,
7680,
7682,
7686,
7688,
7697,
7698,
7700,
7705,
7747,
7751,
7757,
7797,
7799,
7803,
7813,
7871,
7924,
7925,
7933,
7941,
7942,
7947,
7952,
8003,
8025,
8042,
8048,
8055,
8058,
8059,
8061,
8062,
8066,
8069,
8072,
8077,
8079,
8084,
8085,
8086,
8088,
8089,
8090,
8091,
8092,
8095,
8096,
8120,
8124,
8127,
8130,
8140,
8146,
8147,
8148,
8154,
8157,
8158,
8160,
8164,
8168,
8169,
8174,
8177,
8178,
8181,
8185,
8189,
8191,
8192,
8194,
8195,
8202,
8204,
8206,
8207,
8209,
8210,
8212,
8216,
8219,
8220,
8225,
8230,
8241,
8244,
8245,
8248,
8260,
8269,
8273,
8287,
8294,
8307,
8328,
8366,
8434,
8450,
8490,
8521,
8550,
8568,
8576,
8612,
8662,
8786,
8812,
8824,
8827,
8840,
8853,
8951,
8960,
8961,
8987,
8998,
9031,
9071,
9182,
9284,
9304,
9762,
9808,
9833,
9852,
9892,
9901,
9902,
9904,
9929,
9932,
9933,
9935,
9951,
10167,
10173,
10178,
10181,
10192,
10193,
10197,
10221,
10223,
10225,
10232,
10237,
10246,
10269,
10293,
10296,
10335,
10339,
10346,
10357,
10364,
10369,
10446,
10467,
10509,
10517,
10519,
10520,
10537,
10538,
10552,
10557,
10583,
10595,
10600,
10607,
10626,
10639,
10655,
10665,
10712,
10724,
10798,
10834,
10840,
10963,
10983,
10990,
11047,
11098,
11682,
11806,
13143,
14765,
14773,
15375,
15378,
15393,
15423,
15441,
15474,
15475,
15484,
15487,
15490,
15497,
15529,
15563,
15591,
15592,
15595,
15602,
15605,
15635,
15638,
15643,
15644,
15650,
15677,
15679,
15684,
15685,
15691,
15770,
15773,
15779,
15782,
15783,
15792,
15795,
15803,
15806,
15820,
15828,
15834,
15848,
15853,
15856,
15859,
15864,
15874,
15881,
15908,
15913,
15920,
15927,
15928,
15940,
15941,
15953,
15955,
15958,
15961,
15969,
15995,
15996,
16000,
16003,
16007,
16008,
16011,
16013,
16021,
16022,
16023,
16051,
16057,
16059,
16065,
16070,
16073,
16074,
16075,
16085,
16089,
16100,
16121,
16128,
16132,
16134,
16140,
16144,
16154,
16157,
16160,
16165,
16168,
16171,
16174,
16185,
16202,
16206,
16219,
16227,
16271,
16274,
16509,
16516,
16538,
16539,
16561,
16610,
16639,
16657,
16671,
16681,
16707,
16749,
17090,
17584,
17643,
18047,
18048,
18202,
18433,
18482,
18666,
30148,
30335,
30503,
30571,
31502,
31839,
32213,
32303,
32406,
32959,
33041,
33097,
33177,
33660,
33851,
33877,
33878,
33880,
33882,
33885,
33889,
33890,
33891,
33894,
33896,
33897,
33898,
33900,
33901,
33903,
33904,
33905,
33906,
33909,
33912,
33913,
33915,
33916,
33916,
33917,
33919,
33920,
33923,
33924,
33925,
33928,
33929,
33931,
33933,
33934,
33935,
33936,
33938,
33939,
33944,
33946,
33949,
33955,
33956,
33959,
33960,
33963,
33966,
33971,
33972,
33973,
33979,
33981,
33982,
33984,
33987,
33988,
33994,
33995,
33999,
34003,
34004,
34005,
34009,
34012,
34053,
34062,
34066,
34069,
34072,
34095,
34096,
34099,
34101,
34111,
34112,
93481,
93516,
10760,10793,18706,
14766,4491,
1494,18601,
1500,32957,32958,
1536,18649 ,
15416 , 17233, 
15693,15692 ,
15873 , 15880,
16028 , 17154 ,
16533,2040 ,
16535,2283,
16680,3902,
16994,3167,16995,
18568,8094 ,
1968,32074,
2265,32109,
30235 , 8159, 
3154,34098,
31857 , 8251, 
31918,10371 ,
31964,6087 ,
32095,32096,32104 ,
32466 , 15798 ,
32510,10617,
32932,32933,
33171,33172,3905,
33908,34013 ,
33954,1702 ,
33977,34127,
34102,32878,
3947,34051 ,
570 , 16784 ,
5795,5796 ,
5884,34105 ,
6052,31898,31899 ,
6224,32892 ,
6317,6289 ,
703,704 ,
8015,18644,
816,17072 ,
8231 , 16821 , 8114 ,
847,33967,
879,16492,
898 , 18454 )
order by acc.ID

select * from #CCRP
order by AccountType, ID

select * from #CCRP
where ParentID in (33873,33874)

--Campaigns that are run by a CCRP FM, but whose account is not in the CCRP List
--select acc.Id AccountID, acc.Name, camp.ID CampaignID, camp.StartDate, camp.EndDate
select distinct acc.*
into #CCRP2
from QSPCanadaCommon..CAccount acc
join QSPCanadaCommon..Campaign camp on camp.BillToAccountID = acc.Id
join QSPCanadaCommon..FieldManager fm on fm.FMID = camp.FMID
left join #CCRP ccrp ON ccrp.Id = acc.Id
where fm.FMID in (1546, 1547, 1548, 1549, 1550, 1551)
and ccrp.Id is null
and acc.CAccountCodeGroup not in ('Comm')
order by acc.ID

--Campaigns marked as a CCRP account, but shouldn't have been
select *
from CAccount acc
left join #CCRP ccrp ON ccrp.Id = acc.Id
left join #CCRP2 ccrp2 ON ccrp2.Id = acc.Id
where acc.ParentID in (33873,33874)
and CCRP.Id is null
and CCRP2.Id is null

begin tran

update	CAccount
set		ParentID = NULL
where	Id IN (6226,8071,8113,12569,33910)

--79 rows
update	acc
set		ParentID = 33874
from	CAccount acc
join	#CCRP ccrp ON ccrp.Id = acc.Id
where	ccrp.AccountType = 'Eean'

--817 rows
update	acc
set		ParentID = 33873
from	CAccount acc
join	#CCRP ccrp ON ccrp.Id = acc.Id
where	ccrp.AccountType = 'EveryoneElse'

--316 rows
update	acc
set		ParentID = 33873
from	CAccount acc
join	#CCRP2 ccrp ON ccrp.Id = acc.Id

--Report on CCRP accounts and why
select		CASE When ISNULL(ccrp2.Id,0) > 0 and ISNULL(ccrp.Id,0) = 0 Then 'CCRPRepRunsAccountDespiteNo2013CCRPSales' 
				 When ISNULL(ccrp.Id,0) > 0 and ISNULL(ccrp2.Id,0) = 0 Then 'CCRPAccountIn2013'
				 --When ISNULL(ccrp.Id,0) > 0 and ISNULL(ccrp2.Id,0) > 0 Then 'CCRPAccountIn2013ANDCCRPRepRunsAccount'
				 Else 'Error' End 'Reason',
			CASE When ISNULL(CCRP.AccountType,'') = 'Eean' Then 'Eean'
				 Else 'NonEean' End EeanAccount,
			*
from		CAccount acc
left join	#CCRP ccrp ON ccrp.Id = acc.Id
left join	#CCRP2 ccrp2 ON ccrp2.Id = acc.Id
where (ccrp.Id is not null OR ccrp2.Id is not null)
order by ccrp2.Id, EeanAccount, acc.Id

drop table #CCRP
drop table #CCRP2