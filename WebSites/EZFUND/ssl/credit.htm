<%
'Generate Credit Card List
Do While NOT RSCC.EOF
		ccOption = ccOption & vbCrLf & "<option value=" & Trim(RSCC("CARD_ABB")) & ">" & Trim(RSCC("CARD_NAME")) & "</option>"		      
		RSCC.MoveNext
Loop
%>	
<%
'Generate State List
Do While NOT RSState.EOF
		stateOption = stateOption & vbCrLf & "<option value=" & RSState("State_Abb")& ">" & RSState("State") & "</option>"
		RSState.MoveNext
Loop
%>	
<%
'Generate Country List
Do While NOT RSCountry.EOF
		countryOption = countryOption & vbCrLf & "<option value=" & RSCountry("Country_Abb") & ">" & RSCountry("Country") & "</option>"
		RSCountry.MoveNext
Loop
%>
<html>
 <head>
  <script Language="JavaScript"><!--
	function Validate(theForm) {
		if (theForm.CARD_NAME.value == "") {
			alert("Please enter a value for the \"Card Holder Name\" field.");
			theForm.CARD_NAME.focus();
			return (false);
		}

		if (theForm.CARD_TYPE.selectedIndex < 0) {
			alert("Please select one of the \"CARD_TYPE\" options.");
			theForm.CARD_TYPE.focus();
			return (false);
		}

		var checkOK = "0123456789";
		var checkStr = strip(theForm.CARD_NO.value) + '';
		var CrValid = true;
		var checksum=0;
		var ddigit=0;
		var kdig = 0;
		
		if (checkStr.length < 13) {
			alert ('You have not entered enough digits. Please check the number for errors.');
			theForm.CARD_NO.focus(); 
			return (false)
			}
		
		for (i = checkStr.length-1;  i >= 0;  i--) {
			kdig++;
			ch = checkStr.charAt(i);
			if ((kdig % 2) != 0) {
				checksum=checksum+parseInt(ch)
			}
			else {
				ddigit=parseInt(ch)*2;
				if (ddigit >= 10)
					checksum=checksum+1+(ddigit-10)
				else
					checksum=checksum+ddigit;
			}
			for (j = 0;  j < checkOK.length;  j++) {
				if (ch == checkOK.charAt(j)) {
					break;
				}
				if (j == checkOK.length) {
					alert('Please enter only digits. No dashes or non-numeric characters.');
					return(false);
				}
			}
		}
  
		if ((checksum % 10) != 0) {
			alert('You have entered an invalid credit card number. Please check the number for errors.');
			theForm.CARD_NO.focus();
			return (false);
		}

		if (theForm.CARD_EXP.value == "") {
		    alert("Please enter a value for the \"CARD_EXP\" field.");
			theForm.CARD_EXP.focus();
			return (false);
		}

		if (theForm.CARD_EXP.value.length < 5) {
			alert("Please enter at least 5 characters in the \"CARD_EXP\" field.");
			theForm.CARD_EXP.focus();
			return (false);
		}

		var checkOK = "0123456789-/-";
		var checkStr = theForm.CARD_EXP.value;
		var allValid = true;
		
		for (i = 0;  i < checkStr.length;  i++) {
			ch = checkStr.charAt(i);
			for (j = 0;  j < checkOK.length;  j++)
				if (ch == checkOK.charAt(j))
					break;
			if (j == checkOK.length) {
				allValid = false;
				break;
			}
		}
  
		if (!allValid) {
			alert("Please enter only digit and \"/-\" characters in the \"CARD_EXP\" field.");
			theForm.CARD_EXP.focus();
			return (false);
		}

		if (theForm.ADDRESS_2.value == "") {
			alert("Please enter a value for the \"Address\" field.");
			theForm.ADDRESS_2.focus();
			return (false);
		}

		if (theForm.CITY.value == "") {
			alert("Please enter a value for the \"City\" field.");
			theForm.CITY.focus();
			return (false);
		}

		if (theForm.CITY.value.length < 2) {
			alert("Please enter at least 2 characters in the \"City\" field.");
			theForm.CITY.focus();
			return (false);
		}

		if (theForm.State.selectedIndex < 0) {
			alert("Please select one of the \"State\" options.");
			theForm.State.focus();
			return (false);
		}

		if (theForm.COUNTRY.selectedIndex < 0) {
			alert("Please select one of the \"Country\" options.");
			theForm.COUNTRY.focus();
			return (false);
		}

  
		if (theForm.PHONE.value == "") {
			alert("Please enter a value for the \"PHONE\" field.");
			theForm.PHONE.focus();
			return (false);
		}

		if (theForm.E_MAIL.value == "") {
			alert("Please enter a value for the \"E-Mail Address\" field.");
			theForm.E_MAIL.focus();
			return (false);
		}

		if (theForm.E_MAIL.value.length < 5) {
			alert("Please enter at least 5 characters in the \"E-Mail Address\" field.");
			theForm.E_MAIL.focus();
			return (false);
		}

		var checkOK = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzƒŠŒŽšœžŸÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõöøùúûüýþ0123456789-@.-_";
		var checkStr = theForm.E_MAIL.value;
		var allValid = true;
		for (i = 0;  i < checkStr.length;  i++) {
			ch = checkStr.charAt(i);
			for (j = 0;  j < checkOK.length;  j++)
				if (ch == checkOK.charAt(j))
					break;
			if (j == checkOK.length) {
				allValid = false;
				break;
			}
		}
  
		if (!allValid) {
			alert("Please enter only letter, digit and \"@.-_\" characters in the \"E-Mail Address\" field.");
			theForm.E_MAIL.focus();
			return (false);
		}
		
		return (true);
	}

	function strip(number) {
		var sOut = '';
		mask = '1234567890';
		for(count = 0; count <= number.length; count++) {
 			if(mask.indexOf(number.substring(count, count+1),0) != -1 ) sOut += number.substring(count,count+1);
 		}
		return sOut;
	}//-->
  </script>
 </head>
 <body>
  <form method="POST" onSubmit="return Validate(this);" name="Form1" action="confirm.asp?ORDER_ID=<%= Request("Order_ID") %>" name="CreditValidate">
   <table border="0" cellpadding="0" cellspacing="0" width="95%">
    <tr align="center">
     <td align="left" colspan="2">
      <div align="center"><center><p><!--webbot bot="HTMLMarkup" startspan -->
       <input type="hidden" name="PrmShip" value="<% If PrmShip = "1" Then %>1<%Else %>0<% End If %>"> 
       <input type="hidden" name="ShipMeth" value="<%= ShipMeth %>">
       <input type="hidden" name="PaymentMethod" value="<%= PaymentMethod %>">
       <!--webbot bot="HTMLMarkup" endspan --><small><font color="#CC0033"><strong>PAYMENT INFORMATION</strong></font></small></p>
      </div></center>
     </td>
    </tr>
    <tr align="center">
     <td align="right">
      <div align="right"><p><font size="2"><strong>Card Name:</strong></font></p></div>
     </td>
     <td align="left"><input type="text" name="CARD_NAME" size="28" value="<%=P_CUST_NAME%>"><font size="1"><strong>( Required )</strong></font></td>
    </tr>
    <tr align="center">
     <td align="right"><b><font size="2">Card Type: </font></b></td>
     <td align="left">
      <select name="CARD_TYPE" size="1">
       <% Response.Write ccOption %>	
      </select><b> </b><strong><font size="1">( Required For Credit Card Purchase )</font></strong>
     </td>
    </tr>
    <tr align="center">
     <td align="right"><b><font size="2">Credit Card #</font>: </b></td>
     <td align="left"><input type="text" size="28" name="CARD_NO"><strong><font size="1">( Required For Credit Card Purchase )</font></strong></td>
    </tr>
    <tr align="center">
     <td align="right"><b><font size="2">Exp.Date (MM/YY): </font></b></td>
     <td height="25" align="left"><input type="text" size="10" name="CARD_EXP"> <strong><font size="1">( Required for Credit Card Purchase )</font></strong> </td>
    </tr>
    <tr align="center">
     <td align="right" colspan="2">
      <div align="center"><center><p><small><font color="#CC0033"><strong>PURCHASER INFORMATION</strong></font></small></p></div>
     </td>
    </tr>
    <tr align="center">
     <td align="right"><font size="2"><b>Organization/School:</b></font></td>
     <td align="left" height="25"><input type="text" size="30" name="COMPANY" value="<%=P_COMPANY%>"></td>
    </tr>
    <tr align="center">
     <td align="right"><font size="2"><b>Street Address:</b></font></td>
     <td align="left" height="25"><input type="text" size="30" name="ADDRESS_2" value="<%=P_ADDRESS_2%>"> <small><small><strong>
      ( Required )</strong></small></small>
     </td>
    </tr>
    <tr align="center">
     <td align="right"><font size="2"><strong>Apt. or Suite:</strong></font></td>
     <td align="left" height="25"><input type="text" size="20" name="ADDRESS_1" value="<%=P_ADDRESS_1%>"> </td>
    </tr>
    <tr align="center">
     <td align="right"><font size="2"><b>City:</b></font></td>
     <td align="left"><input type="text" size="20" name="CITY" value="<%=P_CITY%>"> <strong><small><small>
      ( Required )</small></small></strong>
     </td>
    </tr>
    <tr align="center">
     <td align="right"><font size="2"><b>State:</b></font></td>
     <td align="left">
      <select name="State" size="1">
       <option value="<%= RSSelState("STATE_ABB") %>" selected><%= RSSelState("STATE") %></option>
		<% Response.Write stateOption %>	
      </select> <small><small><strong>( Required )</strong></small></small>
     </td>
    </tr>
    <tr align="center">
     <td align="right"><font size="2"><b>Country</b></font></td>
     <td align="left">
      <select name="COUNTRY" size="1">
       <option value="<%= RSSelCountry("COUNTRY_ABB") %>" selected><%= RSSelCountry("COUNTRY") %></option>
		<% Response.Write countryOption %>	
      </select><small><small><strong> ( Required )</strong></small></small>
     </td>
    </tr>
    <tr align="center">
     <td align="right"><font size="2"><b>Zip:</b></font></td>
     <td align="left"><input type="text" size="10" name="ZIP" value="<%=P_ZIP%>"></td>
    </tr>
    <tr align="center">
     <td align="right"><font size="2"><b>Telephone: </b></font></td>
     <td align="left"><input type="text" size="20" name="PHONE" value="<%=P_PHONE%>"><font size="1"><strong>( Required )</strong></font></td>
    </tr>
    <tr align="center">
     <td align="right"><font size="2"><b>Fax: </b></font></td>
     <td align="left"><input type="text" size="20" name="FAX" value="<%=P_FAX%>"> </td>
    </tr>
    <tr align="center">
     <td align="right"><font size="2"><b>E-Mail: </b></font></td>
     <td align="left"><input type="text" size="20" name="E_MAIL" value="<%=P_EMAIL%>"> <small><small><strong>( Required )</strong></small></small></td>
    </tr>
    <% If SubscribeMail = "1" Then %>
    <tr align="center">
     <td align="right"><font size="2"><b>Add to Mailing List: </b></font></td>
     <td align="left"><input type="checkbox" checked name="MailSubscribed" value="1"></td>
    </tr> 
    <% Else %>
    <input type="hidden" name="MailSubscribed" value="1">     
    <% End If %>  
    <tr align="center">
     <td align="center" colspan="2"><small><b><font color="#CC0033">SHIPPING INFORMATION</font></b></small></td>
    </tr>
    <tr align="center">
     <td align="right">
      <div align="right"><p><font size="2"><strong>Name:</strong></font></p></div>
     </td>
     <td align="left"><input type="text" size="30" name="SHIP_NAME" value="<%=P_SHIP_NAME%>"></td>
    </tr>
    <tr align="center">
     <td align="right">
      <div align="right"><p><font size="2"><strong>Organization/School:</strong></font></p></div>
     </td>
     <td align="left"><input type="text" size="30" name="SHIP_COMPANY" value="<%=P_SHIP_COMPANY%>"></td>
    </tr>
    <tr align="center">
     <td align="right">
      <div align="right"><p><font size="2"><strong>Address:</strong></font></p></div>
     </td>
     <td align="left"><input type="text" size="30" name="SHIP_ADDRESS_2" value="<%=P_SHIP_ADDRESS_2%>"></td>
    </tr>
    <tr align="center">
     <td align="right">
      <div align="right"><p><font size="2"><strong>Apt. or Suite:</strong></font></p></div>
     </td>
     <td align="left"><input type="text" size="30" name="SHIP_ADDRESS_1" value="<%=P_SHIP_ADDRESS_1%>"></td>
    </tr>
    <tr align="center">
     <td align="right">
      <div align="right"><p><font size="2"><strong>City:</strong></font></p></div>
     </td>
     <td align="left"><input type="text" size="20" name="SHIP_CITY" value="<%=P_SHIP_CITY%>"></td>
    </tr>
    <tr align="center">
     <td align="right" valign="top"><font size="2"><strong>State:</strong></font></td>
     <td align="left" valign="top">
      <div align="left"><p><font size="2">
       <select name="SHIP_STATE" size="1">
        <option selected><%=P_SHIP_STATE%></option>
         <% Response.Write stateOption %>	
       </select></font></p>
      </div>
     </td>
    </tr>
    <tr align="center">
     <td align="right"><font size="2"><b>Country:</b></font></td>
     <td align="left">
      <select name="SHIP_COUNTRY" size="1">
       <option selected><%=P_SHIP_COUNTRY%></option>
		<% Response.Write countryOption %>	
	  </select>
	 </td>
    </tr>
    <tr align="center">
     <td align="right" valign="top"><font size="2"><strong>Zip:</strong></font></td>
     <td align="left" valign="top"><input type="text" size="10" name="SHIP_ZIP" value="<%=P_SHIP_ZIP%>"> </td>
    </tr>
    <tr align="center">
     <td align="right" valign="top"><font size="2"><strong>Telephone:</strong>:</font></td>
     <td align="left" valign="top"><input type="text" size="20" name="SHIP_TELEPHONE" value="<%=P_SHIP_TELEPHONE%>"></td>
    </tr>
    <tr>
     <td align="right" colspan="2"><font size="2">
      <div align="center"><center><p></font><small><b><font color="#CC0033">SPECIAL INSTRUCTIONS</font></b></small><font size="2"></font></p></div>
     </td>
    </tr>
    <tr align="center">
     <td align="right" valign"top"></td>
     <td align="left" valign="top"><textarea name="SHIP_MESSAGE" rows="2" cols="47"></textarea></td>
    </tr>
    <tr align="center">
     <td align="right"></td>
     <td align="right"><input type="submit" value="Complete Order" name="Submit"></td>
    </tr>
   </table>
  </form>
 </body>
</html>